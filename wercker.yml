box: maven:3.5.0-jdk-8

services:
    - id: mariadb
      env:
        MYSQL_ROOT_PASSWORD: booking
        MYSQL_DATABASE: bookingproject

provision:
  steps:
    - install-packages:
        packages: mysql-client netcat
    - script:
        name: "Wait for MariaDB connection"
        code: |
          while ! nc -q 1 $MARIADB_PORT_3306_TCP_ADDR $MARIADB_PORT_3306_TCP_PORT </dev/null; do sleep 3; done
    - script:
        name: provision db
        code: |
          mysql -h $MARIADB_PORT_3306_TCP_ADDR -u root -p$MARIADB_ENV_MYSQL_ROOT_PASSWORD --port=$MARIADB_PORT_3306_TCP_PORT --protocol=TCP < database/databaseBookingCreation.sql

build:
    - add-ssh-key:
        keyname: GITHUB_KEY
    - add-to-known_hosts:
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa
        local: true
    - script:
        name: maven build
        code: |
          mvn clean install